---
title: The Algebra of Color Design
description: The Grand Unified Algebra (v4.1) for UI rendering.
slug: theory/algebra
tableOfContents: false
---

import { Aside } from "@astrojs/starlight/components";
import TufteLayoutActivator from "../../../components/TufteLayoutActivator.astro";
import "@fontsource-variable/eb-garamond";

<TufteLayoutActivator />

> _Context_: The physics and grammar of the color system.[^axiomatic]

This document defines the "Physics" of the color system. It replaces the previous static heuristic model with a _Reactive Physics Model_ based on continuous state interpolation.

## 1. The State Space ($\Sigma$)

> **Definition 1** (State Configuration $\Sigma$). The system configuration is a 5-tuple $\Sigma = \langle \alpha, \mathcal{V}, \tau, \gamma, \mu \rangle$ where:

1.  **Atmosphere** ($\alpha$): The environmental vector $\alpha = \langle H, \beta \rangle$.
    - $H \in S^1$: _Hue_. The base angle of the environment.
    - $\beta \in [ 0, 1 ]$: _Vibrancy Coefficient_. A scalar multiplier acting on the maximum potential chroma ($C$) of the environment.
2.  **Voice** ($\mathcal{V}$): The semantic intent.
    - Let $T$ be the set of pre-solved lightness constants derived by the lighting function $f_L$ (see Section 2.1).
    - $\mathcal{V} \in T$: A reference to a specific semantic intent (e.g., _High Contrast_).
      <Aside type="note" title="Implementation">
        In the Axiomatic system, intents map to tokens like `text-high` and
        `text-subtle`.
      </Aside>
3.  **Time** ($\tau$): The normalized temporal parameter.
    - $\tau \in [ -1, 1 ]$: Represents the shift from Night ($-1$) to Day ($+1$).
4.  **Gain** ($\gamma$): The user's contrast preference.
    - $\gamma \in [ 1, \infty )$. Amplifies the _Voice_ ($\mathcal{V}$) target contrast. Used for _High Contrast Mode_.
5.  **Mode** ($\mu$): The rendering technique.
    - $\mu \in \{ 0, 1 \}$:
      - 0: _Rich Mode_ (Standard).
      - 1: _X-Ray Mode_ (Forced Colors).[^remark1]

[^remark1]: **Remark**:

    - **Atmosphere**: The "Weather" of the room.
    - **Voice**: The "Script".
    - **Time**: The "Clock".
    - **Gain**: The "Volume Knob". (Turn it up for High Contrast).
    - **Mode**: The "Physics Engine". (Rich vs. X-Ray).

## 2. The Architecture: Static Initialization vs. Runtime Algebra

The system is explicitly split into two domains to guarantee performance and correctness.

### 2.1. Pre-Computation Routine (Static Phase)

The _initialization routine_[^genesis] solves the "Hard Math" (APCA Contrast) offline. It calculates the exact Lightness ($L$) required for a specific Voice ($\mathcal{V}$) to be legible against a specific background.

It also applies a _Helmholtz-Kohlrausch Buffer_ to offset the perceptual lightness of vibrant colors.

$$
\begin{aligned}
\Psi(K, \tau) &\to \mathcal{V}_{\text{constant}} \\
L_{\text{target}} &= L_{\text{APCA}} + (k_{hk} \cdot \beta)
\end{aligned}
$$

These constants are baked into the CSS as variables (e.g., `--text-high-L: 98%`).

### 2.2. Algebra (Render Time)

The _Algebra_ (CSS Engine)[^algebra] is a "Switching Mixer." It resolves the final color based on the System Mode ($\mu$).

$$
\Phi(\Sigma) = \begin{cases}
\Phi_{\text{rich}}(\alpha, \mathcal{V}, \tau, \gamma) & \text{if } \mu = 0 \\
\Phi_{\text{xray}}(\alpha, \mathcal{V}) & \text{if } \mu = 1
\end{cases}
$$

## 3. The Operators

Classes in the system are _Operators_ that transform the state $\Sigma \to \Sigma'$.

### 3.1. The Surface Split

We distinguish between two topological types of surfaces.

#### 3.1.1. Glass Surfaces ($S_{\text{glass}}$)

Glass surfaces are _Filters_. They inherit the Atmosphere ($\alpha$) from their parent but apply _Bicone Dampening_ to ensure the background remains a subtle tint, safe for text.

{/* prettier-ignore */}
$$
S_{\text{glass}}(\langle \alpha, \mathcal{V}, \tau \rangle) = \langle \text{Dampen}(\alpha), \mathcal{V}_{\text{reset}}, \tau \rangle
$$

#### 3.1.2. Solid Surfaces ($S_{\text{solid}}$)

Solid surfaces are _Emitters_. They represent "pre-calculated pairs" (like Primary Buttons) where the color is derived at build-time to be maximal. They do _not_ dampen. They establish a _new_ Atmosphere.

{/* prettier-ignore */}
$$
S_{\text{solid}}(\langle \alpha, \mathcal{V}, \tau \rangle) = \langle \alpha_{\text{new}}, \mathcal{V}_{\text{new}}, \tau \rangle
$$

## 4. The Universal Safety Theorem (Adaptive Clamping)

To guarantee that text is always readable on Glass Surfaces in _Rich Mode_, we enforce the _Universal Safety Theorem_. The Chroma ($C$) of any Glass Surface is mathematically constrained to lie within the _Safe Bicone_.

### 4.1. The Vibrancy Limit ($C_{\text{limit}}$)

The maximum allowed Chroma is the intersection of three functions:

$$
C_{\text{limit}} = \beta(H) \cdot \text{Taper}(L) \cdot \zeta(\tau)
$$

1.  _The Sine Wave_ ($\beta(H)$): The hue-dependent boundary.

    $$
    \beta(H) = C_{\text{floor}} + (C_{\text{ceil}} - C_{\text{floor}}) \cdot \left( \frac{1 + \sin(H + \phi)}{2} \right)
    $$

2.  _The Bicone Taper_ ($\text{Taper}(L)$): The lightness-dependent boundary. Defined as a _Linear Taper_ (Absolute Value).

    <Aside type="note" title="Rationale">
      The linear absolute value ensures precise containment within the sRGB
      gamut.
    </Aside>

    $$
    \text{Taper}(L) = 1 - |2L - 1|
    $$

3.  _The Tunnel_ ($\zeta(\tau)$): The motion-dependent boundary. Defined as a _Parabolic Ease_ function.

    <Aside type="note" title="Note">
      Parabolic easing prevents velocity shock (derivative discontinuity) during
      state transitions.
    </Aside>

    $$
    \zeta(\tau) = \tau^2
    $$

    [^remark2]

[^remark2]: **Remark**:

    - _The Sine Wave_: Yellows can be brighter than Blues.
    - _The Bicone_: As you get closer to White or Black, the allowed chroma drops linearly to zero.
    - _The Tunnel_: During the twilight transition, we dim the colors to ensure safety.

### 4.2. The Dampening Function

For Glass Surfaces, the resolved Chroma is the minimum of the requested Vibrancy and the Limit.

{/* prettier-ignore */}
$$
C_{\text{resolved}} = \min(C_{\text{requested}}, C_{\text{limit}})
$$

## 5. The Hollow State (X-Ray Mode)

When $\mu = 1$ (Forced Colors), the system enters _X-Ray Mode_.

- _Physics is Disabled_: The Bicone/Tunnel math is skipped.
- _Topology is Transformed_: Surfaces are no longer defined by _Area_ (Background Color) but by _Boundary_ (Border).

$$
P(\alpha) \to \text{BorderWidth} \times \text{SystemColor}
$$

This ensures that the semantic structure of the UI is preserved even when the operating system strips all background colors.

## 6. Summary

1.  _State is Unified_: $\Sigma = \langle \alpha, \mathcal{V}, \tau, \gamma, \mu \rangle$.
2.  _Safety is Geometric_: The _Safe Bicone_ ensures text legibility by clamping Chroma linearly.
3.  _Mode is Topological_: _Rich Mode_ paints pixels; _X-Ray Mode_ draws lines (The Hollow State).
4.  _Execution is Split_: The initialization routine solves the goals; Algebra enforces the constraints.

[^axiomatic]: The **Axiomatic Color** system (v4.1).

[^genesis]: The **Genesis Engine** implements this routine in v2.0.

[^algebra]: Implemented by the **Axiomatic CSS** runtime.
