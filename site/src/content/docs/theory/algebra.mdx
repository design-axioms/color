---
title: The Algebra of Color Design
description: The Grand Unified Algebra (v4.1) for UI rendering.
slug: theory/algebra
---

import { Aside } from "@astrojs/starlight/components";
import PlainEnglish from "../../../components/PlainEnglish.svelte";
import "@fontsource-variable/eb-garamond";

<style>{`
  .sl-markdown-content {
    font-family: "EB Garamond Variable", "EB Garamond", serif;
    font-size: 1.25rem;
    line-height: 1.6;
    max-width: 65ch;
    text-align: justify;
    hyphens: auto;
  }

  /* Headings */
  .sl-markdown-content h2 {
    font-family: "EB Garamond Variable", "EB Garamond", serif;
    font-weight: 600;
    margin-top: 3rem !important;
    margin-bottom: 1.25rem !important;
    border-bottom: 1px solid var(--axm-border-dec-token);
    padding-bottom: 0.5rem;
    letter-spacing: -0.01em;
  }

  .sl-markdown-content h3 {
    font-family: "EB Garamond Variable", "EB Garamond", serif;
    font-weight: 500;
    margin-top: 2.5rem !important;
    margin-bottom: 1rem !important;
    font-size: 1.5rem !important;
  }

  /* Math Centering */
  .katex-display {
    display: block !important;
    text-align: center;
    margin: 2rem 0;
    width: 100%;
    overflow-x: auto;
  }
  
  .katex-display > .katex {
    display: inline-block;
    text-align: center;
  }
`}</style>

> **Context**: The physics and grammar of the Axiomatic Color system.

This document defines the "Physics" of the Axiomatic Color system. It replaces the previous static heuristic model with a **Reactive Physics Model** based on continuous state interpolation.

## 1. The State Space (Σ)

The system state at any point in the DOM tree is defined by the **Unified State Tuple** $\Sigma$. This configuration space represents the continuous interpolation between environmental extremes and system modes.

$$ \Sigma = \langle \alpha, \nu, \tau, \gamma, \sigma \rangle $$

Where:

1.  **Atmosphere ($\alpha$)**: The environmental vector.
    $$ \alpha = \langle H, \beta \rangle $$
    - $H \in S^1$: **Hue**. The base angle of the environment.
    - $\beta \in [0, 1]$: **Vibrancy Coefficient**. The maximum potential chroma of the environment.

2.  **Voice ($\nu$)**: The semantic intent.
    - $\nu \in \text{Tokens}$: A reference to a pre-solved lightness constant derived by **Genesis** (e.g., `text-high`, `text-subtle`).

3.  **Time ($\tau$)**: The continuous temporal scalar.
    - $\tau \in [-1, 1]$: Represents the shift from Night ($-1$) to Day ($+1$).

4.  **Gain ($\gamma$)**: The user's contrast preference.
    - $\gamma \ge 1.0$: Amplifies the Voice ($\nu$) target contrast.
    - Used for **High Contrast Mode**.

5.  **System ($\sigma$)**: The rendering mode.
    - $\sigma \in \{0, 1\}$:
      - $0$: **Rich Mode** (Standard).
      - $1$: **X-Ray Mode** (Forced Colors).

<PlainEnglish>
- **Atmosphere ($\alpha$)**: The "Weather" of the room.
- **Voice ($\nu$)**: The "Script".
- **Time ($\tau$)**: The "Clock".
- **Gain ($\gamma$)**: The "Volume Knob". (Turn it up for High Contrast).
- **System ($\sigma$)**: The "Physics Engine". (Rich vs. X-Ray).
</PlainEnglish>

## 2. The Architecture: Genesis vs. Algebra

The system is explicitly split into two domains to guarantee performance and correctness.

### 2.1. Genesis (Build Time)

The **Genesis** engine solves the "Hard Math" (APCA Contrast) offline. It calculates the exact Lightness ($L$) required for a specific Voice ($\nu$) to be legible against a specific background.

It also applies a **Helmholtz-Kohlrausch Buffer** to offset the perceptual lightness of vibrant colors.

{/* prettier-ignore */}
$$
\begin{aligned}
\Psi(K, T) &\rightarrow \nu_{constant} \\
L_{target} &= L_{APCA} + (k_{hk} \times \beta)
\end{aligned}
$$

These constants are baked into the CSS as variables (e.g., `--text-high-L: 98%`).

### 2.2. Algebra (Render Time)

The **Algebra** (CSS Engine) is a "Switching Mixer." It resolves the final color based on the System Mode ($\sigma$).

$$ \Phi(\Sigma) = \begin{cases} \Phi_{rich}(\alpha, \nu, \tau, \gamma) & \text{if } \sigma = 0 \\ \Phi_{xray}(\alpha, \nu) & \text{if } \sigma = 1 \end{cases} $$

## 3. The Operators

Classes in the system are **Operators** that transform the state $\Sigma \rightarrow \Sigma'$.

### 3.1. The Surface Split

We distinguish between two topological types of surfaces.

#### 3.1.1. Glass Surfaces ($S_{glass}$)

Glass surfaces are **Filters**. They inherit the Atmosphere ($\alpha$) from their parent but apply **Bicone Dampening** to ensure the background remains a subtle tint, safe for text.

{/* prettier-ignore */}
$$ S_{glass}(\langle \alpha, \nu, \tau \rangle) = \langle \text{Dampen}(\alpha), \nu_{reset}, \tau \rangle $$

#### 3.1.2. Solid Surfaces ($S_{solid}$)

Solid surfaces are **Emitters**. They represent "Genesis Pairs" (like Primary Buttons) where the color is derived at build-time to be maximal. They do _not_ dampen. They establish a _new_ Atmosphere.

{/* prettier-ignore */}
$$ S_{solid}(\langle \alpha, \nu, \tau \rangle) = \langle \alpha_{new}, \nu_{new}, \tau \rangle $$

## 4. The Universal Safety Theorem (Adaptive Clamping)

To guarantee that text is always readable on Glass Surfaces in **Rich Mode**, we enforce the **Universal Safety Theorem**. The Chroma ($C$) of any Glass Surface is mathematically constrained to lie within the **Safe Bicone**.

### 4.1. The Vibrancy Limit (Cₗᵢₘᵢₜ)

The maximum allowed Chroma is the intersection of three functions:

$$ C_{limit} = \beta(H) \cdot \text{Taper}(L) \cdot \zeta(\tau) $$

1.  **The Sine Wave ($\beta(H)$)**: The hue-dependent boundary.
    {/* prettier-ignore */}
    $$ \beta(H) \approx C_{floor} + (C_{ceil} - C_{floor}) \cdot \frac{1 + \sin(H + \phi)}{2} $$

2.  **The Bicone Taper ($\text{Taper}(L)$)**: The lightness-dependent boundary. We use a **Linear Taper** (Absolute Value) to ensure precise containment within the sRGB gamut.
    $$ \text{Taper}(L) = 1 - |2L - 1| $$

3.  **The Tunnel ($\zeta(\tau)$)**: The motion-dependent boundary. We use a **Parabolic Ease** to prevent velocity shock during transitions.
    $$ \zeta(\tau) = \tau^2 $$

<PlainEnglish>
- **The Sine Wave**: Yellows can be brighter than Blues.
- **The Bicone**: As you get closer to White or Black, the allowed chroma drops linearly to zero.
- **The Tunnel**: During the twilight transition, we dim the colors to ensure safety.
</PlainEnglish>

### 4.2. The Dampening Function

For Glass Surfaces, the resolved Chroma is the minimum of the requested Vibrancy and the Limit.

{/* prettier-ignore */}
$$ C_{resolved} = \min(C_{requested}, C_{limit}) $$

## 5. The Hollow State (X-Ray Mode)

When $\sigma = 1$ (Forced Colors), the system enters **X-Ray Mode**.

- **Physics is Disabled**: The Bicone/Tunnel math is skipped.
- **Topology is Transformed**: Surfaces are no longer defined by **Area** (Background Color) but by **Boundary** (Border).

$$ P(\alpha) \rightarrow \text{BorderWidth} \times \text{SystemColor} $$

This ensures that the semantic structure of the UI is preserved even when the operating system strips all background colors.

## 6. Summary

1.  **State is Unified**: $\Sigma = \langle \alpha, \nu, \tau, \gamma, \sigma \rangle$.
2.  **Safety is Geometric**: The **Safe Bicone** ensures text legibility by clamping Chroma linearly.
3.  **Mode is Topological**: **Rich Mode** paints pixels; **X-Ray Mode** draws lines (The Hollow State).
4.  **Execution is Split**: Genesis solves the goals; Algebra enforces the constraints.
