@layer starlight, overrides;

/* Starlight Overrides */

@font-face {
  font-family: "Latin Modern Math";
  src: url("/fonts/LatinModernMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "STIX Two Math";
  src: url("/fonts/STIXTwoMath-Regular.ttf") format("truetype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Libertinus Math";
  src: url("/fonts/LibertinusMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "TeX Gyre Pagella Math";
  src: url("/fonts/TexGyrePagellaMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "TeX Gyre Termes Math";
  src: url("/fonts/TexGyreTermesMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Fira Math";
  src: url("/fonts/FiraMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Garamond Math";
  src: url("/fonts/Garamond-Math.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Erewhon Math";
  src: url("/fonts/Erewhon-Math.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Asana Math";
  src: url("/fonts/Asana-Math.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "XITS Math";
  src: url("/fonts/XITSMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "KpMath";
  src: url("/fonts/KpMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Neo Euler";
  src: url("/fonts/NeoEuler.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Pennstander Math";
  src: url("/fonts/PennstanderMath-Regular.otf") format("opentype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

/* Global MathML Styling */
@layer overrides {
  :root {
    --font-math:
      "Erewhon Math", "Libertinus Math", "STIX Two Math", "Latin Modern Math",
      serif;
  }

  :root.font-pennstander {
    --font-math: "Pennstander Math", "Erewhon Math", serif;
  }

  math {
    font-family: var(--font-math);
    font-size: 1.25em; /* Bump size for better readability */
    line-height: initial; /* Prevent inherited line-height from messing up vertical alignment */
  }

  /* Prevent Starlight's generic content margin from pushing inline math down */
  .sl-markdown-content math:not([display="block"]) {
    margin-top: 0;
  }

  .sl-markdown-content code:not(:where(.not-content *)) {
    background-color: var(--axm-surface-token);
    border: 1px solid var(--axm-border-dec-token);
    padding: 0.1em 0.3em;
    border-radius: 0.25em;
  }

  math * {
    margin: initial;
  }

  /* Center the wrapper if possible */
  .katex:has(math[display="block"]) {
    display: block;
    text-align: center;
  }

  math[display="block"] {
    display: grid;
    margin-block: 1.5em;
    width: 100%;
    font-size: 1.5em;
    place-items: center;
  }

  /* Mapping the Axiomatic Color System to Starlight's variables */

  :root[data-theme="light"],
  :root[data-theme="light"] body {
    color-scheme: light;
  }

  :root[data-theme="dark"],
  :root[data-theme="dark"] body {
    color-scheme: dark;
  }

  /* 
   * We apply these mappings on `body` because `theme.css` defines the 
   * Axiomatic tokens on `body` (and .surface-page), not :root.
   */
  body {
    /* --- Grays (Mapping to Axiomatic Neutrals) --- */
    --sl-color-gray-1: var(--axm-text-high-token);
    --sl-color-gray-2: var(--axm-text-subtle-token);
    --sl-color-gray-3: var(--axm-text-subtlest-token);
    --sl-color-gray-4: var(--axm-border-int-token);
    --sl-color-gray-5: var(--axm-border-dec-token);
    --sl-color-gray-6: var(--axm-surface-token);

    /* --- Brand Colors --- */
    --sl-color-accent-low: oklch(0.4 0.1 var(--axm-hue-brand));
    --sl-color-accent: oklch(0.6 0.15 var(--axm-hue-brand));
    --sl-color-accent-high: oklch(0.8 0.1 var(--axm-hue-brand));

    /* --- Backgrounds --- */
    --sl-color-bg: var(--axm-surface-token);
    --sl-color-bg-nav: var(--axm-surface-token);
    --sl-color-bg-sidebar: var(--axm-surface-token);

    /* --- Text --- */
    --sl-color-text: var(--axm-text-high-token);
    --sl-color-text-invert: light-dark(oklch(1 0 0), oklch(0 0 0));
    --sl-color-text-accent: var(--sl-color-accent);

    /* --- Borders --- */
    --sl-color-hairline: var(--axm-border-dec-token);
    --sl-color-border: var(--axm-border-int-token);
  }

  :root {
    --font-stix-two-math: var(--font-math);
    --sl-font-system:
      "Inter Variable", ui-sans-serif, system-ui, -apple-system,
      BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
      sans-serif;
    --sl-font-heading: "Space Grotesk Variable", var(--sl-font-system);
    --sl-font-mono:
      "JetBrains Mono Variable", ui-monospace, SFMono-Regular, Menlo, Monaco,
      Consolas, "Liberation Mono", "Courier New", monospace;
    --sl-sidebar-width: 18rem;
  }

  .sl-markdown-content p,
  .sl-markdown-content li {
    text-wrap: pretty;
  }

  html {
    overflow-y: scroll;
  }
}

/* Unlayered utilities */
.docs-grid-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin: 2rem 0;
  align-items: start;
}

.docs-grid-comparison > div {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.docs-grid-comparison > div > strong {
  display: block;
  margin-bottom: 1rem;
  font-size: 0.9em;
  color: var(--sl-color-gray-3);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.debug-marker {
  color: red;
}

/* --- Axiomatic Overrides for Starlight Components --- */

/* 1. Primary Action Button -> Surface Action (Brand) */
.sl-link-button.primary {
  /* Brand Context */
  --alpha-hue: var(--_axm-hue-brand);
  --alpha-beta: var(--_axm-chroma-brand);

  /* Surface Action Tokens (Copied from theme.css) */
  --axm-surface-token: light-dark(
    oklch(0.1 var(--alpha-beta) var(--alpha-hue)),
    oklch(0.9 var(--alpha-beta) var(--alpha-hue))
  );

  --axm-text-high-token: light-dark(oklch(1 0 0), oklch(0 0 0));

  /* Reset Starlight */
  border: none;
  text-decoration: none;
}

/* 2. Cards -> Surface Card */
.card {
  /* Surface Card Tokens (Copied from theme.css) */
  --axm-surface-token: light-dark(
    oklch(0.9687 var(--alpha-beta) var(--alpha-hue)),
    oklch(0.2911 var(--alpha-beta) var(--alpha-hue))
  );

  /* Reset Starlight */
  background-color: transparent; /* Let the physics take over */
  border: 1px solid var(--axm-border-dec-token);
}

/* 3. Search Button -> Surface Input/Action Soft */
site-search button {
  /* Surface Action Soft Tokens (Copied from theme.css) */
  --axm-surface-token: light-dark(
    oklch(0.9355 var(--alpha-beta) var(--alpha-hue)),
    oklch(0.3543 var(--alpha-beta) var(--alpha-hue))
  );

  border: 1px solid var(--axm-border-dec-token);
  border-radius: 0.5rem;
}

/* Apply Reactive Pipeline Logic to these selectors */
.sl-link-button.primary,
.card,
site-search button {
  /* Text Resolution */
  --_axm-text-lightness-source: var(--axm-text-high-token);
  --_axm-computed-fg-C: calc(var(--alpha-beta) * 0.5);
  --_axm-computed-fg-color: oklch(
    from var(--_axm-text-lightness-source)
      calc(l + (0.05 * var(--_axm-computed-fg-C))) var(--_axm-computed-fg-C)
      var(--alpha-hue)
  );
  color: var(--_axm-computed-fg-color);

  /* Surface Resolution */
  --_axm-computed-surface: oklch(
    from var(--axm-surface-token) l
      min(
        var(--alpha-beta),
        var(--alpha-beta) * (1 - abs(2 * l - 1)) * var(--tau) * var(--tau)
      )
      h
  );
  background-color: var(--_axm-computed-surface);
}

/* 4. Code Blocks -> Surface Workspace */
.astro-code {
  /* Surface Workspace Tokens (Copied from theme.css) */
  --axm-surface-token: light-dark(
    oklch(0.9926 var(--alpha-beta) var(--alpha-hue)),
    oklch(0.1935 var(--alpha-beta) var(--alpha-hue))
  );

  /* Force override of Shiki's inline styles */
  background-color: var(--axm-surface-token) !important;
  border: 1px solid var(--axm-border-dec-token);
  border-radius: 0.5rem;
}

/* 5. Hero Section Safeguard */
.hero {
  /* Ensure the hero is always treated as a dark context if intended, 
     or at least respects the system theme correctly. 
     The issue was "invisible text" in dark mode. */
  position: relative;
  z-index: 1;
  background-color: transparent; /* Let the page surface show through */
}

/* Ensure Hero Actions use our buttons */
.hero .action {
  /* Reset Starlight button styles if needed, but .sl-link-button.primary above might cover it */
}

/* 6. Responsive Tables (Tokens Page) */
.sl-markdown-content table {
  display: block;
  overflow-x: auto;
  white-space: nowrap;
  width: 100%;
}

/* Optional: Make the description column wrap if we want to avoid scrolling, 
   but scrolling is usually safer for long token names. 
   Let's stick to scrolling for now as per the plan. */
