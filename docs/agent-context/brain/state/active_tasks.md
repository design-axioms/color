# Current Work (2025-12-17): Claim Ledger Triage — Epoch 2 (Theme Studio alignment)

## Goal

- Ship the Epoch 2 implementation as a PR from branch `epoch-2/theme-studio-alignment`.

## Current Status

- Epoch 2 implementation is complete.
- Verification is green:
  - `pnpm -w check:site`
  - `pnpm -w test`
  - `pnpm -w test:playwright tests/studio.spec.ts`

## Known Footguns / Invariants

- `css/theme.css` is part of the public export surface (`package.json` exports `./theme.css`). Tests and cleanups must never delete it.
- `site/src/styles/theme.css` is generated by `pnpm --filter site generate:theme` and may get rewritten during builds/tests; avoid committing it unless the generator output meaningfully changes.

## Immediate Next Steps

- Open PR for `epoch-2/theme-studio-alignment`.
- Optional “full pre-push gate” before pushing:
  - `pnpm build`
  - `pnpm check:exports`
  - `pnpm lint:all`
  - `pnpm test:playwright`

## Handoff Note

- If a prompt like `cast-auto.prompt.md` must be followed strictly, it needs to exist inside the workspace (suggested location: `docs/agent-context/brain/prompts/`).

---

# Epoch 44, Phase 2.1: RFC 011 Follow-up (Refactor Completion)

Phase 2 is complete; see `docs/agent-context/changelog.md` for the archival record.

## Objectives

1. Finish the remaining RFC 011 refactor edges (typing + registry boundary).
2. Close the loop on remaining real transition snaps.
3. Keep the inspector overlay behavior regression-proof.

## Tasks

### RFC 011: Typed Registry Boundary

- [ ] Remove remaining `any`/weak typing at the heterogenous `CheckModule` registry boundary.
- [ ] Ensure replay vs live runs share the same output formatting and report payload shapes.

### Transition Smoothness: Remaining Snaps

- [ ] Re-run `pnpm check:violations -- --snaps --snaps-focus` on key docs pages.
- [ ] Fix remaining real tau-stable snaps (or codify detector refinement + regression test if they are artifacts).

### Inspector Overlay UX Hardening

- [ ] Add a Playwright check ensuring continuity flashing stops immediately when the overlay is disabled mid-run.
- [ ] Manual QA checkpoint: open overlay, run continuity, disable mid-audit, verify no further theme flips.

### Starlight Chrome Continuity: CSSOM Sentinel Migration

- [ ] Add a CSSOM-based chrome rule sentinel (Playwright) that scans rules for non-bridge-routed borders and competing transitions.
- [ ] Prove the sentinel catches a seeded violation (then remove the seed).
- [ ] After verification, migrate existing border “witness” tests to a selector-fed witness set (no broad DOM scanning).
